<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drumkit</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html { height: 100vh; overflow: hidden; font-family: sans-serif; background: #1e1e1e; color: #eee; }
    .app { display: flex; flex-direction: column; height: 100%; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #2a2a2a; }
    header span { font-size: 1.5rem; }
    header select { background: #333; color: #eee; border: 1px solid #444; padding: 4px 8px; border-radius: 4px; }
    .main { flex: 1; display: flex; }
    .grid-container { flex: 2; display: flex; justify-content: center; align-items: center; }
    table { border-collapse: collapse; }
    td { width: 28px; height: 28px; border: 1px solid #444; cursor: pointer; transition: background 0.2s; }
    td.active { background: #ff4081; }
    footer { background: #2a2a2a; padding: 8px; display: flex; justify-content: space-around; }
    .inst-btn { flex: 1; text-align: center; padding: 8px 0; cursor: pointer; transition: background 0.2s; }
    .inst-btn:hover { background: #333; }
    .panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 0; background: #2a2a2a; overflow: hidden; transition: height 0.3s ease; }
    .panel.open { height: 40%; }
    .panel-header { padding: 12px; font-size: 1.2rem; border-bottom: 1px solid #444; }
    .panel-content { padding: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .panel-content label { display: flex; flex-direction: column; font-size: 0.9rem; }
    .panel-content input, .panel-content select { margin-top: 4px; }
    .close-btn { position: absolute; right: 16px; top: 16px; cursor: pointer; font-size: 1.2rem; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <select id="genreSelect">
        <option value="">Select Genre</option>
        <option>Rock</option>
        <option>4‑on‑the‑Floor</option>
        <option>Funk</option>
        <option>Trap</option>
        <option>Bossa Nova</option>
        <option>Disco</option>
        <option>House</option>
      </select>
    </header>
    <div class="main">
      <div class="grid-container">
        <table id="drumGrid"></table>
      </div>
    </div>
    <footer>
      <div class="inst-btn" data-inst="kick">Kick</div>
      <div class="inst-btn" data-inst="snare">Snare</div>
      <div class="inst-btn" data-inst="hihat">Hi-Hat</div>
    </footer>
    <div id="panel" class="panel">
      <div class="panel-header">
        <span id="panelTitle"></span>
        <span id="closePanel" class="close-btn">✕</span>
      </div>
      <div id="panelContent" class="panel-content"></div>
    </div>
  </div>
  <script>
    const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const instruments = ['kick','snare','hihat'], steps=16, tempo=120;
    const pattern = { kick:[], snare:[], hihat:[] };
    let isPlaying=false, timerID;
    const grid = document.getElementById('drumGrid');
    instruments.forEach(inst=>{
      pattern[inst]=new Array(steps).fill(false);
      const row=document.createElement('tr');
      for(let i=0;i<steps;i++){
        const td=document.createElement('td');
        td.dataset.inst=inst; td.dataset.step=i;
        td.onclick=()=>{ pattern[inst][i]=!pattern[inst][i]; td.classList.toggle('active'); };
        row.appendChild(td);
      }
      grid.appendChild(row);
    });
    const defaults = {
      kick: { type:'sine', startF:150, endF:0.001, decay:0.5 },
      snare:{ filterF:1000, decay:0.2, level:1 },
      hihat:{ filterF:7000, decay:0.05, level:0.5 }
    };
    const params = JSON.parse(JSON.stringify(defaults));
    const presets = {
      'Rock':  { kick:[1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0], snare:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], hihat:Array(16).fill(1) },
      '4‑on‑the‑Floor': { kick:Array(16).fill(0).map((_,i)=>i%4===0), snare:Array(16).fill(0), hihat:Array(16).fill(1) },
      'Funk':   { kick:[1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], snare:Array(16).fill(0).map((_,i)=>i%4===2), hihat:[1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1] },
      'Trap':   { kick:[1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], snare:Array(16).fill(0).map((_,i)=>i%8===4), hihat:Array(16).fill(0).map((_,i)=>i%2===0) },
      'Bossa Nova':{ kick:[1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], snare:[0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1], hihat:[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1] },
      'Disco':  { kick:Array(16).fill(0).map((_,i)=>i%4===0), snare:Array(16).fill(0).map((_,i)=>i%4===2), hihat:Array(16).fill(1) },
      'House':  { kick:Array(16).fill(0).map((_,i)=>i%4===0), snare:Array(16).fill(0).map((_,i)=>i%8===4), hihat:Array(16).fill(1) }
    };
    function updateGrid(){
      document.querySelectorAll('#drumGrid td').forEach(cell=>{
        const inst=cell.dataset.inst, step=cell.dataset.step;
        cell.classList.toggle('active', pattern[inst][step]);
      });
    }
    document.getElementById('genreSelect').onchange = e => {
      const g = e.target.value;
      if(presets[g]){
        Object.assign(pattern, JSON.parse(JSON.stringify(presets[g])));
        updateGrid();
      }
    };
    const panel = document.getElementById('panel');
    const panelTitle = document.getElementById('panelTitle');
    const panelContent = document.getElementById('panelContent');
    document.querySelectorAll('.inst-btn').forEach(btn=> btn.onclick=()=>openPanel(btn.dataset.inst));
    document.getElementById('closePanel').onclick=()=>panel.classList.remove('open');
    function openPanel(inst){
      panelTitle.textContent = inst.charAt(0).toUpperCase()+inst.slice(1)+' Settings';
      panelContent.innerHTML='';
      const p = params[inst];
      const controls = {
        kick:[{label:'Waveform',type:'select',key:'type',options:['sine','square','triangle','sawtooth']},
              {label:'Start Freq',type:'range',key:'startF',min:50,max:400,step:1},
              {label:'End Freq',type:'range',key:'endF',min:0.001,max:150,step:0.1},
              {label:'Decay (s)',type:'range',key:'decay',min:0.1,max:1,step:0.05}],
        snare:[{label:'Filter Freq',type:'range',key:'filterF',min:200,max:5000,step:1},
               {label:'Decay (s)',type:'range',key:'decay',min:0.05,max:1,step:0.05},
               {label:'Level',type:'range',key:'level',min:0.1,max:2,step:0.1}],
        hihat:[{label:'Filter Freq',type:'range',key:'filterF',min:1000,max:12000,step:1},
               {label:'Decay (s)',type:'range',key:'decay',min:0.01,max:0.5,step:0.01},
               {label:'Level',type:'range',key:'level',min:0.1,max:1,step:0.05}]
      };
      controls[inst].forEach(c=>{
        const lbl=document.createElement('label'); lbl.textContent=c.label;
        let inp;
        if(c.type==='select'){
          inp=document.createElement('select');
          c.options.forEach(o=>{ const opt=document.createElement('option'); opt.value=o; opt.textContent=o; if(p[c.key]===o) opt.selected=true; inp.appendChild(opt); });
        } else {
          inp=document.createElement('input'); inp.type='range'; inp.min=c.min; inp.max=c.max; inp.step=c.step; inp.value=p[c.key];
        }
        inp.oninput = ()=>{ params[inst][c.key] = c.type==='range'? +inp.value : inp.value; };
        lbl.appendChild(inp);
        panelContent.appendChild(lbl);
      });
      panel.classList.add('open');
    }
    function playKick(t){ const {type,startF,endF,decay}=params.kick; const osc=audioCtx.createOscillator(), gain=audioCtx.createGain(); osc.type=type; osc.frequency.setValueAtTime(startF,t); osc.frequency.exponentialRampToValueAtTime(endF,t+decay); gain.gain.setValueAtTime(1,t); gain.gain.exponentialRampToValueAtTime(0.001,t+decay); osc.connect(gain).connect(audioCtx.destination); osc.start(t); osc.stop(t+decay); }
    function playSnare(t){ const {filterF,decay,level}=params.snare; const size=audioCtx.sampleRate*decay; const buf=audioCtx.createBuffer(1,size,audioCtx.sampleRate); const d=buf.getChannelData(0); for(let i=0;i<size;i++) d[i]=Math.random()*2-1; const noise=audioCtx.createBufferSource(); noise.buffer=buf; const filter=audioCtx.createBiquadFilter(); filter.type='bandpass'; filter.frequency.value=filterF; const gain=audioCtx.createGain(); gain.gain.setValueAtTime(level,t); gain.gain.exponentialRampToValueAtTime(0.001,t+decay); noise.connect(filter).connect(gain).connect(audioCtx.destination); noise.start(t); noise.stop(t+decay); }
    function playHiHat(t){ const {filterF,decay,level}=params.hihat; const size=audioCtx.sampleRate*decay; const buf=audioCtx.createBuffer(1,size,audioCtx.sampleRate); const d=buf.getChannelData(0); for(let i=0;i<size;i++) d[i]=Math.random()*2-1; const noise=audioCtx.createBufferSource(); noise.buffer=buf; const filter=audioCtx.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=filterF; const gain=audioCtx.createGain(); gain.gain.setValueAtTime(level,t); gain.gain.exponentialRampToValueAtTime(0.001,t+decay); noise.connect(filter).connect(gain).connect(audioCtx.destination); noise.start(t); noise.stop(t+decay); }
    function schedule(){ const interval=(60/tempo)/4; const now=audioCtx.currentTime; for(let i=0;i<steps;i++){ const t=now+i*interval; if(pattern.kick[i]) playKick(t); if(pattern.snare[i]) playSnare(t); if(pattern.hihat[i]) playHiHat(t); } }
    function loop(){ schedule(); timerID=setTimeout(loop,(60/tempo)*1000); }
    document.body.onkeydown=e=>{ if(e.code==='Space'){ e.preventDefault(); if(!isPlaying){ isPlaying=true; loop(); } else { isPlaying=false; clearTimeout(timerID); } } };
  </script>
</body>
</html>